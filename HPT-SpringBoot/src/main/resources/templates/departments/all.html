<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
          name="viewport">
    <title>All Departments</title>
    <!-- CSS Bootstrap 5 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>

</head>
<body>
<script>
    $(document).ready(function () {
        loadDepartments();

        function loadDepartments() {
            $.ajax({
                url: "/api/department",
                method: "GET",
                success: function (data) {
                    let departmentRow = $("#department-list");
                    departmentRow.empty();
                    data.forEach(function (department) {
                        departmentRow.append(`
                                <tr>
                                    <td>${department.department_id}</td>
                                    <td>${department.department_name}</td>
                                    <td><a href="/department/update/${department.department_id}"><button type="button" class="btn btn-danger">Update</button></a></td>
                                    <td><button type="button" class="delete-department btn btn-danger" data-id="${department.department_id}">Delete</button></td>
                                </tr>
                            `);
                    });
                },
                error: function (error) {
                    console.log("Error fetching departments", error);
                }
            });
        }

        // Delete department. Get event click department button on department list
        $("#department-list").on("click", ".delete-department", function () {
            const departmentId = $(this).data("id");
            $.ajax({
                url: "/api/department/" + departmentId,
                method: "DELETE",
                success: function (data) {
                    alert("Deleted " + departmentId + " successfully!");
                    loadDepartments();
                    window.location.href = "/department/";
                },
                error: function () {
                    alert("Failed to update department.");
                }
            });
        });

    });
</script>

<div class="container">
    <h1 class="p-t-3">Department List</h1>
    <section class="d-flex p-t-3 pb-3">
        <input class="form-control w-25" type="search" placeholder="Department ID" aria-label="Department ID">
        <button class="btn btn-outline-success" type="submit">Search</button>
    </section>

    <a th:href="@{/department/add}">
        <button type="button" class="btn btn-danger">Add Department</button>
    </a>
    <table id="departmentTable" class="table table-striped">
        <thead>
        <tr>
            <th>Department ID</th>
            <th>Department Name</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="department-list">
        <!-- Data department list -->

        </tbody>
    </table>
</div>

<!-- JavaScript Boostrap 5 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>